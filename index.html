<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<title>بازی تو و سه لیوان</title>
<style>
  body {
    background: #222;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    user-select: none;
  }
  h1 {
    margin-bottom: 10px;
  }
  #game {
    margin: 20px auto;
    width: 360px;
    position: relative;
  }
  .cup {
    width: 100px;
    height: 140px;
    background: #555;
    border-radius: 0 0 50px 50px;
    display: inline-block;
    margin: 0 15px;
    position: relative;
    cursor: pointer;
    box-shadow: 0 5px 10px rgba(0,0,0,0.7);
    transition: transform 0.5s ease;
  }
  .cup:hover {
    transform: translateY(-15px);
  }
  #ball {
    width: 30px;
    height: 30px;
    background: #e74c3c;
    border-radius: 50%;
    position: absolute;
    top: 110px;
    left: 20px;
    transition: left 0.6s ease;
    box-shadow: 0 0 10px #e74c3c;
  }
  #message {
    margin-top: 25px;
    font-size: 22px;
    min-height: 40px;
  }
  #level {
    margin-top: 15px;
    font-size: 18px;
  }
  #startBtn {
    margin-top: 25px;
    padding: 12px 30px;
    font-size: 20px;
    background-color: #1abc9c;
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #startBtn:hover:not(:disabled) {
    background-color: #16a085;
  }
  #startBtn:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h1>بازی تو و سه لیوان</h1>
<div id="level">مرحله: 1</div>

<div id="game">
  <div class="cup" data-index="0"></div>
  <div class="cup" data-index="1"></div>
  <div class="cup" data-index="2"></div>
  <div id="ball"></div>
</div>

<div id="message"></div>
<button id="startBtn">شروع بازی</button>

<script>
  const cups = document.querySelectorAll('.cup');
  const ball = document.getElementById('ball');
  const message = document.getElementById('message');
  const levelDisplay = document.getElementById('level');
  const startBtn = document.getElementById('startBtn');

  // موقعیت‌های لیوان‌ها (px نسبت به والد)
  const cupPositions = [15, 130, 245];
  let currentBallIndex = 0;
  let level = 1;
  let shuffleSpeed = 800; // سرعت شروع
  let shuffleCount = 0;
  let maxShuffles = 5;

  let isShuffling = false;

  // قرار دادن توپ زیر اولین لیوان در شروع
  function placeBall(index) {
    ball.style.left = (cupPositions[index] + 35) + 'px';
    currentBallIndex = index;
  }

  // شروع بازی
  function startGame() {
    level = 1;
    shuffleSpeed = 800;
    maxShuffles = 5;
    levelDisplay.textContent = 'مرحله: ' + level;
    message.textContent = '';
    startBtn.disabled = true;
    placeBall(0);
    setTimeout(shuffleCups, 800);
  }

  // جابجایی نرم توپ بین لیوان‌ها
  function moveBallTo(index) {
    ball.style.left = (cupPositions[index] + 35) + 'px';
    currentBallIndex = index;
  }

  // Shuffle - جابجایی توپ بین لیوان‌ها چند بار و سریع‌تر مرحله به مرحله
  function shuffleCups() {
    isShuffling = true;
    shuffleCount = 0;

    function singleShuffle() {
      if (shuffleCount >= maxShuffles) {
        isShuffling = false;
        message.textContent = 'حالا حدس بزن توپ کجاست!';
        return;
      }
      // انتخاب جای جدید توپ، متفاوت از قبلی
      let nextIndex;
      do {
        nextIndex = Math.floor(Math.random() * 3);
      } while (nextIndex === currentBallIndex);

      moveBallTo(nextIndex);
      shuffleCount++;

      setTimeout(singleShuffle, shuffleSpeed);
    }

    singleShuffle();
  }

  // کاربر کلیک روی لیوان
  cups.forEach(cup => {
    cup.addEventListener('click', () => {
      if (isShuffling) return; // اگه داره جابجا میشه اجازه نده حدس بزنه
      const guess = parseInt(cup.dataset.index);

      if (guess === currentBallIndex) {
        message.textContent = 'تبریک! درست حدس زدی!';
        level++;
        levelDisplay.textContent = 'مرحله: ' + level;
        shuffleSpeed = Math.max(250, shuffleSpeed - 120); // افزایش سرعت
        maxShuffles = Math.min(15, maxShuffles + 2); // افزایش دفعات جابجایی
        startBtn.disabled = false;
      } else {
        message.textContent = 'اشتباه! توپ زیر لیوان شماره ' + (currentBallIndex + 1) + ' بود.';
        startBtn.disabled = false;
      }
    });
  });

  startBtn.addEventListener('click', () => {
    message.textContent = '...جار می‌زنم';
    startBtn.disabled = true;
    shuffleSpeed = Math.max(250, shuffleSpeed); // reset speed if restarted
    maxShuffles = 5;
    shuffleCups();
  });

  // جایگذاری اولیه توپ
  placeBall(0);
</script>

</body>
</html>