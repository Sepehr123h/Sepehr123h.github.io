<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<title>بازی تو و سه لیوان</title>
<style>
  body {
    background: #222;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    user-select: none;
  }
  h1 {
    margin-bottom: 10px;
  }
  #game {
    margin: 20px auto;
    width: 360px;
    position: relative;
    height: 180px;
  }
  .cup {
    width: 100px;
    height: 140px;
    background: #555;
    border-radius: 0 0 50px 50px;
    display: inline-block;
    margin: 0 15px;
    position: relative;
    cursor: pointer;
    box-shadow: 0 5px 10px rgba(0,0,0,0.7);
    transition: transform 0.3s ease;
    z-index: 10;
  }
  .cup:hover {
    transform: translateY(-15px);
  }
  #ball {
    width: 40px;
    height: 40px;
    background: #e74c3c;
    border-radius: 50%;
    position: absolute;
    bottom: 25px;
    left: 15px;
    transition: left 0.6s ease;
    box-shadow: 0 0 15px #e74c3c;
    z-index: 5;
  }
  #message {
    margin-top: 25px;
    font-size: 22px;
    min-height: 40px;
  }
  #level {
    margin-top: 15px;
    font-size: 18px;
  }
  #startBtn {
    margin-top: 25px;
    padding: 12px 30px;
    font-size: 20px;
    background-color: #1abc9c;
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #startBtn:hover:not(:disabled) {
    background-color: #16a085;
  }
  #startBtn:disabled {
    background-color: #555;
    cursor: not-allowed;
  }

  /* انیمیشن تکان خوردن */
  @keyframes shake {
    0% { transform: translate(0, 0); }
    20% { transform: translate(-5px, 0); }
    40% { transform: translate(5px, 0); }
    60% { transform: translate(-5px, 0); }
    80% { transform: translate(5px, 0); }
    100% { transform: translate(0, 0); }
  }

  .shake {
    animation: shake 0.5s ease;
  }
</style>
</head>
<body>

<h1>بازی تو و سه لیوان</h1>
<div id="level">مرحله: 1</div>

<div id="game">
  <div class="cup" data-index="0"></div>
  <div class="cup" data-index="1"></div>
  <div class="cup" data-index="2"></div>
  <div id="ball"></div>
</div>

<div id="message"></div>
<button id="startBtn">شروع بازی</button>

<script>
  const cups = document.querySelectorAll('.cup');
  const ball = document.getElementById('ball');
  const message = document.getElementById('message');
  const levelDisplay = document.getElementById('level');
  const startBtn = document.getElementById('startBtn');

  const cupPositions = [15, 130, 245];
  let currentBallIndex = 0;
  let level = 1;
  let shuffleSpeed = 800;
  let shuffleCount = 0;
  let maxShuffles = 5;

  let isShuffling = false;

  function placeBall(index) {
    ball.style.left = (cupPositions[index] + 30) + 'px';
    currentBallIndex = index;
  }

  function startGame() {
    level = 1;
    shuffleSpeed = 800;
    maxShuffles = 5;
    levelDisplay.textContent = 'مرحله: ' + level;
    message.textContent = '';
    startBtn.disabled = true;
    placeBall(0);
    setTimeout(shuffleCups, 800);
  }

  function shuffleCups() {
    isShuffling = true;
    shuffleCount = 0;

    function singleShuffle() {
      if (shuffleCount >= maxShuffles) {
        isShuffling = false;
        message.textContent = 'حالا حدس بزن توپ کجاست!';
        return;
      }
      let nextIndex;
      do {
        nextIndex = Math.floor(Math.random() * 3);
      } while (nextIndex === currentBallIndex);

      placeBall(nextIndex);
      shuffleCount++;

      setTimeout(singleShuffle, shuffleSpeed);
    }

    singleShuffle();
  }

  cups.forEach(cup => {
    cup.addEventListener('click', () => {
      if (isShuffling) return;
      const guess = parseInt(cup.dataset.index);

      // حذف کلاس shake از همه لیوان‌ها اول
      cups.forEach(c => c.classList.remove('shake'));

      if (guess === currentBallIndex) {
        message.textContent = 'تبریک! درست حدس زدی!';
        // اضافه کردن انیمیشن تکان خوردن به لیوان درست
        cup.classList.add('shake');
        level++;
        levelDisplay.textContent = 'مرحله: ' + level;
        shuffleSpeed = Math.max(250, shuffleSpeed - 120);
        maxShuffles = Math.min(15, maxShuffles + 2);
        startBtn.disabled = false;
      } else {
        message.textContent = 'اشتباه! توپ زیر لیوان شماره ' + (currentBallIndex + 1) + ' بود.';
        // تکان خوردن لیوان درست که توپ زیرشه
        cups[currentBallIndex].classList.add('shake');
        startBtn.disabled = false;
      }
    });
  });

  startBtn.addEventListener('click', () => {
    message.textContent = '...جار می‌زنم';
    startBtn.disabled = true;
    shuffleSpeed = Math.max(250, shuffleSpeed);
    maxShuffles = 5;
    shuffleCups();
  });

  placeBall(0);
</script>

</body>
</html>